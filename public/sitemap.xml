
import { MongoClient } from "mongodb";

export async function getServerSideProps({ res }) {
  const backendUrl = process.env.MONGODB_URI; // add in .env
  const client = await MongoClient.connect(backendUrl);
  const db = client.db("yourdbname"); // replace with your db name
  const products = await db.collection("products").find({}, { projection: { _id: 1 } }).toArray();

  client.close();

  // Build XML
  const baseUrl = "https://sharmafurnitureworks.com";
  let urls = `
    <url>
      <loc>${baseUrl}/</loc>
      <changefreq>daily</changefreq>
      <priority>1.0</priority>
    </url>
    <url>
      <loc>${baseUrl}/products</loc>
    </url>
    <url>
      <loc>${baseUrl}/furniture-shop-sameli-katihar</loc>
    </url>
    <url>
      <loc>${baseUrl}/furniture-buying-guide-bihar</loc>
    </url>
    <url>
      <loc>${baseUrl}/best-furniture-deals-bihar</loc>
    </url>
     <url>
      <loc>${baseUrl}/blog</loc>
    </url>
  `;

  products.forEach((product) => {
    urls += `
      <url>
        <loc>${baseUrl}/product/${product._id}</loc>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
      </url>`;
  });

  const sitemap = `<?xml version="1.0" encoding="UTF-8"?>
  <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    ${urls}
  </urlset>`;

  res.setHeader("Content-Type", "text/xml");
  res.write(sitemap);
  res.end();

  return { props: {} };
}

export default function Sitemap() {
  return null;
}

